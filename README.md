

## åœ¨é¡¹ç›®ä¸­æœ‰ä¸€äº›ç”¨æˆ·æƒ³è¦å®ç° è½¯ä»¶è‡ªåŠ¨æ£€æµ‹ï¼Œè°ƒæŸ¥äº†ä¸‹ï¼Œåœ¨AppStoreä¸­æœ‰ä¸€æ¬¾èƒ½å®ç°è‡ªåŠ¨æ£€æµ‹æ‰‹æœºä½¿ç”¨æ—¶é•¿çš„è½¯ä»¶ å«Moment,å‘ç°äº†è¿™ä¸ªè½¯ä»¶å¯ä»¥è‡ªåŠ¨å¯åŠ¨ï¼Œå¹¶æ£€æµ‹ç”¨æˆ·çš„ä½¿ç”¨æ‰‹æœºæ—¶é•¿ï¼Œå°±è°ƒæŸ¥äº†ä¸‹è¿™ä¸ªåº”ç”¨çš„Api(æ±‚ä¸ªâ­ï¸ğŸ¥º)
Automatic Startup
=================

## feature
  
 * å®ç°åº”ç”¨â»“æ—¶é—´é©»ï§åå°ã€‚
 * å®ç°åº”â½¤åœ¨ä¸ä¸»åŠ¨æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨å¯åŠ¨
 * å®ç°ç”¨æˆ·â¾ä¸ºæ£€æµ‹(æ£€æµ‹æ˜¯å¦è§£é”å’Œé”å±)

## how to use
ä½¿ç”¨çœŸæœºæµ‹è¯•ï¼Œå°†åº”ç”¨é€€å‡ºåˆ°åå°ï¼Œå¹¶å…³é—­åº”ç”¨ï¼Œå½“ä½ çš„ä½ç½®å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚ä»å…¬å¸åˆ°å®¶çš„è·¯ä¸Šï¼Œå°±ä¼šè‡ªåŠ¨æ¿€æ´»è¿™ä¸ªè½¯ä»¶

## ç›¸å…³è°ƒç ”

### Moment è°ƒç ”

#### ç›®çš„

Momentæ˜¯å¦å¯æŒç»­åå°ï¼Œè€—ç”µæƒ…å†µï¼Œæ˜¯å¦èƒ½è‡ªåŠ¨å¯åŠ¨ï¼Œåº•å±‚å®ç°æ–¹å¼ã€‚ åº”ç”¨ä»‹ç»
![å›¾ç‰‡](https://github.com/ChinaChailu/LocationAutomaticStartup/blob/master/11492766723_.pic_hd.jpg)

#### ç‰¹ç‚¹

1. å¯å®ç°ä¸å¼€å¯åº”ç”¨çš„æƒ…å†µä¸‹â¾ƒåŠ¨å¯åŠ¨
2. å¯æŒç»­åœ¨åå°æ£€æµ‹ ç‰¹åˆ«çœç”µï¼Œä»…æ¯”ï¥§ä½¿â½¤æ­¤åº”â½¤æ¯å¤©å¢åŠ  5%çš„ç”¨ç”µé‡
       
 
#### è°ƒæŸ¥è¿‡ç¨‹å’Œç»“æœ

é€šè¿‡æŸ¥è¯¢ `stackoverflow`,`Google`,`github`,`baidu`

å¾—åˆ°ç»“æœï¼šå®ç°â¾ƒåŠ¨å¯åŠ¨ å…³é”®API `startMonitoringSignificantLocationChanges` åœ¨æ³¨å†Œæ­¤æ¥å£åï¼Œè¢«ç”¨æˆ·æˆ–ç³»ç»Ÿå¼ºè¡Œé€€å‡ºåï¼Œç³»ç»Ÿä¾ç„¶å¯ä»¥â¾ƒåŠ¨å¯åŠ¨åº”ç”¨ï¼Œè¿›ï¨ˆå…³é”®ä½ç½®å®šä½
ç¼–å†™æµ‹è¯•Demoï¼Œæµ‹è¯•æ­¤API,æ— æ³•æŒç»­åå° ï¼Œä»…å¯è¢«ç³»ç»Ÿå”¤é†’10ç§’é’Ÿ
å®ç°æŒç»­åå°
é€šè¿‡æŸ¥é˜…èµ„ï¦¾ï¼Œå¯é€šè¿‡æ³¨å†Œä¸¤ä¸ª CLLication å¯¹è±¡ ç¬¬ä¸€ä¸ªç”¨æ¥æ§åˆ¶ Appâ¾ƒåŠ¨å¯åŠ¨
ç¬¬äºŒä¸ªç”¨æ¥æ§åˆ¶ AppæŒç»­é©»ç•™ï§åå°
APPæŒç»­é©»ï§å®ç°æ–¹å¼

1. æ¯æ¬¡è¿›å…¥åº”ç”¨å é€šè¿‡ startMonitoringSignificantLocationChanges æ³¨å†ŒæœåŠ¡ã€‚
2. æ³¨å†Œè¿‡æ­¤æœåŠ¡å ç³»ç»Ÿä¼šåœ¨ ä½ç½®å‘ç”Ÿå˜åŒ–åâ¾ƒåŠ¨å”¤é†’åº”ç”¨ï¼Œ(å®æµ‹ï¼Œé€€å‡ºåº”ç”¨ååœ¨è·ç¦»2å…¬â¾¥é‡Œï§©çš„åœ°â½…æ–¹åº”ç”¨è¢«â¾ƒåŠ¨å”¤é†’äº†ï¦ºï¼Œæ‰‹æœºæ²¡ç”µâ¾ƒåŠ¨å…³æœºåï¼Œå……ç”µå®Œæˆåï¼Œä¹Ÿä¼šâ¾ƒåŠ¨å”¤é†’åº”ç”¨) 
3. å½“åº”ç”¨å”¤é†’å åªæœ‰10ç§’å¯åŠ¨æ—¶é—´ï¼Œè¿™æ—¶å€™ åˆ›å»ºæ–°çš„ CLLocationManager å¯¹è±¡ï¼Œï§ç”¨startUpdatingLocatio å¯å°†åå°æ—¶é—´å»¶â»“åˆ°180ç§’ 
4. å¯åŠ¨å®šæ—¶å™¨ï¨¸ï¼Œå½“æ£€æµ‹åˆ°åå°å‰©ä½™å°äº30ç§’ï¼Œåœ¨æ¬¡è°ƒç”¨ startUpdatingLocatio å¯åœ¨æ¬¡ å°†åå°æ—¶é—´å»¶â»“åˆ° 180ç§’ 
5. é€šè¿‡å¾ªç¯è°ƒç”¨startUpdatingLocatioï¼Œå®ç°æ— é™åˆ¶åå°ä»£ç 

```
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
//åˆ›å»ºå®šä½ç®¡ç†ï§¤è€…å•ä¾‹ï¦µ
	SignificantLocationManager *manager = [SignificantLocationManager shareManager];
	 manager.isUnStartBackgoundLocation = YES; //å½“launchOptionsä¸­æœ‰UIApplicationLaunchOptionsLocationKeyè¡¨æ˜æ˜¯ç³»ç»Ÿå› ä¸ºä½ç½®å‘ç”Ÿé‡â¼¤å¤§å˜åŒ–ï¼Œâ¾ƒåŠ¨å¯åŠ¨äº†ï¦ºç¨‹åº 
	 if (launchOptions[UIApplicationLaunchOptionsLocationKey]) {
		manager.isRunFromeSystem = YES;
		[[BackgroundLocationManager shareManager] sendLocalNoification]; 
		}
	//å¼€å§‹é‡â¼¤å¤§ä½ç½®æ”¹å˜å®šä½
	[manager startMonitoringSignificantLocationChanges];
	[self redirectDLogToDocumentFolder];
	return YES; 
}
åœ¨ SignificantLocationManagerçš„ didUpdateLocations ä¸­ å”¤é†’å¦â¼€ä¸€ä¸ª BackgroundLocationManager
-(void)locationManager:(CLLocationManager *)manager didUpdateLocations:(NSArray<CLLocation *> *)locations {
	if (self.isUnStartBackgoundLocation) {
		if ([UIApplication sharedApplication].applicationState == UIApplicationStateBackground) { 
			self.isUnStartBackgoundLocation = YES;
			BackgroundLocationManager *mange = [BackgroundLocationManager shareManager];
			[mange startChickBgTime]; }
		}
	}
```
åœ¨å¦ä¸€ä¸ªçš„ BackgroundLocationManager ä¸­ å¼€å§‹ æ£€æŸ¥å‰©ä½™åå°æ—¶é—´

```
- (void)startChickBgTime {
	[self.bgTaskTimer invalidate];
	self.bgTaskTimer = nil;
	self.bgTaskTimer = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(bgTaskTimerAction) userInfo:nil repeats:YES
];
	[[BGTask shareBGTask] beginNewBackgroundTask];
}
         å½“åå°æ—¶é—´ â¼©å°äº30ç§’ ç”³è¯·å®šä½

- (void)bgTaskTimerAction {
	NSTimeInterval backgroundTimeRemaining = [[UIApplication sharedApplication] backgroundTimeRemaining]; 
	if (backgroundTimeRemaining == DBL_MAX){
		NSLog(@"B=T=R = Undetermined"); 
	} else {
		NSLog(@"B=T=R = %.02f ", backgroundTimeRemaining);
		if (backgroundTimeRemaining < 30 && self.isStartUpdatingLocation == NO) {
		} 
	}
}
NSLog(@"å¼€å§‹å®šä½"); self.isStartUpdatingLocation = YES; [self startUpdatingLocation];

```

åœ¨å®šä½æˆåŠŸåï¼Œåœ¨æ¬¡ç”³è¯·åå°æ—¶é—´ 180ç§’

```

-(void)locationManager:(CLLocationManager *)manager didUpdateLocations:(NSArray<CLLocation *> *)locations {
	//è¿™ä¸ªæ˜¯æˆ‘å°è£…çš„ç”¨æ¥è·å–åå°æ—¶é—´çš„ä¸€ä¸ªå•ä¾‹ï¦µ
	[[BGTask shareBGTask] beginNewBackgroundTask]; 
	[self stopUpdatingLocation]; self.isStartUpdatingLocation = NO;
}

```

ä¼˜åŒ–åæµ‹è¯•ç»“æœ
åˆ©ç”¨æ­¤APIå¯å®ç°çš„åŠŸèƒ½

1. å®ç°åå°é©»ï§
2. å®ç°â¾ƒåŠ¨å¯åŠ¨ 3ã€å®ç°ç”¨æˆ·å›å®¶åï¼Œâ¾ƒåŠ¨å¼€å§‹ç¡çœ ç›‘æµ‹
![å›¾ç‰‡](https://github.com/ChinaChailu/LocationAutomaticStartup/blob/master/IMG_2415.PNG)
å°šæœªè§£å†³çš„é—®é¢˜

1. å¦‚æœç”¨æˆ·ä¸»åŠ¨é€€å‡ºåï¼Œâ»“æ—¶é—´æ²¡æœ‰ç§»åŠ¨ï¼Œä¸€ç›´é©»ï§åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œæ— æ³•â¾ƒåŠ¨å¯åŠ¨ å°šæ— æ³•è§£å†³ 
2. è€—ç”µï¼Œå½“å‰è€—ç”µï¥¾ æ— æ³•è¾¾åˆ°Moment é‚£æ · ä¸€å¤©çš„è€—ç”µï¥¾ä»…ä¸º 5% 
3. å¦‚æœç”¨æˆ·å¼€å¯é£â¾æ¨¡å¼ï¼Œæ— æ³•å®ç°åå°é©»ï§ï¼Œâ¾ƒåŠ¨å¯åŠ¨
4. å¦‚æœç”¨æˆ·å…³é—­ å®šä½æƒé™ æ— æ³•å®ç°åå°é©»ï§ï¼Œâ¾ƒåŠ¨å¯åŠ¨

* é—®é¢˜1: è¿™ä¸ªé—®é¢˜Momentä¹Ÿå­˜åœ¨ å¦‚æœâ¼€ç›´å¾…åœ¨åŒä¸€ä¸ªåœ°â½…æ–¹æ˜¯æ²¡åŠæ³•â¾ƒåŠ¨å¯åŠ¨çš„
* é—®é¢˜2: è€—ç”µæˆ‘å°è¯•ï¦ºå¥½å‡ ç§â½…æ–¹å¼ï¼ŒåŒ…æ‹¬å°†å®šä½èŒƒå›´æ”¾åˆ°æœ€å¤§ï¼Œå’Œæ¯æ¬¡å®šä½å®Œæˆå…³é—­å®šä½ï¼Œéƒ½æ— æ³•è§£å†³ï¼Œç›®å‰è€—ç”µé‡ 8% 
* é—®é¢˜3ï¼Œé—®é¢˜4: è‡ªåŠ¨å¯åŠ¨æ˜¯å…³é”®ï¼Œä½†æ˜¯å…³é—­åº”ç”¨æƒé™çš„æƒ…å†µä¸‹æ˜¯æ²¡æœ‰åŠæ³•è‡ªåŠ¨å¯åŠ¨çš„ï¼Œå¦‚æœèƒ½è‡ªåŠ¨å¯åŠ¨ï¼Œå¯ä»¥æ¢ é™é»˜â¾³æŒç»­åå°




 **æµ‹è¯•æ–¹å¼**
  
App  				  | æ˜¯å¦è‡ªåŠ¨å¯åŠ¨   | ä¸»åŠ¨é€€å‡ºåº”â½¤åå¯åŠ¨ | å…³æœºåå¯åŠ¨
------------------ | ------------- | -------------  | --------
Moment   			  | True			  | True           | True
Automatic Startup  | True  			  | True           | True


`è€—ç”µé‡`: æµ‹è¯• 19.2â¼©å°æ—¶ è€—ç”µï¥¾ 8% 
 
 
 [è°ƒç ”èµ„ï¦¾](https://wigl.github.io/2015/08/28/ios_location_introduction/)
 
[å®˜æ–¹APIä»‹ç»](https://developer.apple.com/documentation/corelocation/cllocationmanager/1423531-startmonitoringsignificantlocati?language=objc)
    
 
